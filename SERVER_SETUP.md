# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã Deploy

## üìã –ß—Ç–æ –Ω—É–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

–≠—Ç–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç —Å–µ—Ä–≤–µ—Ä –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã –∫–æ–º–∞–Ω–¥—ã `php artisan deploy` –Ω–∞ shared-—Ö–æ—Å—Ç–∏–Ω–≥–µ (Beget –∏ –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–µ).

**–í–ê–ñ–ù–û:** –ù–∞ —ç—Ç–æ–º —Å–µ—Ä–≤–µ—Ä–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `php8.2` –≤–º–µ—Å—Ç–æ `php`. –í—Å–µ –∫–æ–º–∞–Ω–¥—ã —Å PHP –¥–æ–ª–∂–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `php8.2`.

---

## üîπ –®–ê–ì 1: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø–æ SSH

1. –í –ø–∞–Ω–µ–ª–∏ —Ö–æ—Å—Ç–∏–Ω–≥–∞ –≤–∫–ª—é—á–∏—Ç–µ SSH –¥–æ—Å—Ç—É–ø
2. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É:
   ```bash
   ssh login@server.beget.com
   ```
   (–∑–∞–º–µ–Ω–∏—Ç–µ `login` –∏ `server.beget.com` –Ω–∞ –≤–∞—à–∏ –¥–∞–Ω–Ω—ã–µ)

---

## üîπ –®–ê–ì 2: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Composer

### 2.1. –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ Composer

**–í–ê–ñ–ù–û:** –ù–∞ —ç—Ç–æ–º —Å–µ—Ä–≤–µ—Ä–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `php8.2` –≤–º–µ—Å—Ç–æ `php`

```bash
cd ~
php8.2 -r "copy('https://getcomposer.org/installer', 'composer-setup.php');"
php8.2 composer-setup.php
rm composer-setup.php
```

### 2.2. –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –≤ bin –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∞–≤

```bash
mkdir -p ~/bin
mv composer.phar ~/bin/composer
chmod +x ~/bin/composer
```

### 2.3. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ PATH

–û—Ç–∫—Ä–æ–π—Ç–µ `.bashrc`:
```bash
nano ~/.bashrc
```

–î–æ–±–∞–≤—å—Ç–µ –≤ –∫–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞:
```bash
export PATH="$HOME/bin:$PATH"
```

–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ (Ctrl+O, Enter, Ctrl+X) –∏ –ø—Ä–∏–º–µ–Ω–∏—Ç–µ:
```bash
source ~/.bashrc
```

### 2.4. –ü—Ä–æ–≤–µ—Ä–∫–∞ Composer

```bash
composer -V
```

–î–æ–ª–∂–Ω–∞ –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å—Å—è –≤–µ—Ä—Å–∏—è Composer.

---

## üîπ –®–ê–ì 3: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Node.js —á–µ—Ä–µ–∑ nvm

### 3.1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ nvm

```bash
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.7/install.sh | bash
```

–ü—Ä–∏–º–µ–Ω–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:
```bash
source ~/.bashrc
```

### 3.2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Node.js (LTS –≤–µ—Ä—Å–∏—è)

```bash
nvm install --lts
nvm use --lts
nvm alias default node
```

### 3.3. –ü—Ä–æ–≤–µ—Ä–∫–∞ Node.js –∏ npm

```bash
node -v
npm -v
```

–î–æ–ª–∂–Ω—ã –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å—Å—è –≤–µ—Ä—Å–∏–∏.

### 3.4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ PATH –¥–ª—è npm (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

–ï—Å–ª–∏ –∫–æ–º–∞–Ω–¥—ã `npm` –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç, –¥–æ–±–∞–≤—å—Ç–µ –≤ `.bashrc`:

```bash
nano ~/.bashrc
```

–î–æ–±–∞–≤—å—Ç–µ –≤ –∫–æ–Ω–µ—Ü:
```bash
export PATH="$PATH:$(npm config get prefix)/bin"
```

–ü—Ä–∏–º–µ–Ω–∏—Ç–µ:
```bash
source ~/.bashrc
```

---

## üîπ –®–ê–ì 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—É—Ç–µ–π

–í—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:

```bash
which composer
which node
which npm
```

–ó–∞–ø–∏—à–∏—Ç–µ –ø—É—Ç–∏, –æ–Ω–∏ –º–æ–≥—É—Ç –ø–æ–Ω–∞–¥–æ–±–∏—Ç—å—Å—è –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ `.env`.

---

## üîπ –®–ê–ì 5: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

### 5.1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞

```bash
cd ~/laravel/public_html
```

### 5.2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Composer

```bash
composer install --no-dev --optimize-autoloader
```

### 5.3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ npm (–µ—Å–ª–∏ –µ—Å—Ç—å frontend)

```bash
cd frontend
npm install
cd ..
```

### 5.4. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ `.env` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

–û—Ç–∫—Ä–æ–π—Ç–µ `.env`:
```bash
nano .env
```

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É–∫–∞–∑–∞–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø—É—Ç–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –µ—Å–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç):

```env
# –ü—É—Ç–∏ –∫ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –≤—Ä—É—á–Ω—É—é)
NPM_PATH=/home/login/.nvm/versions/node/v20.10.0/bin/npm
COMPOSER_PATH=/home/login/bin/composer

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–µ–ø–ª–æ—è
DEPLOY_SERVER_URL=https://your-server.com
DEPLOY_TOKEN=your-secret-token
GIT_REPOSITORY_URL=https://github.com/username/repo.git
```

–ó–∞–º–µ–Ω–∏—Ç–µ –ø—É—Ç–∏ –Ω–∞ —Ç–µ, —á—Ç–æ –ø–æ–ª—É—á–∏–ª–∏ –≤ –®–ê–ì 4.

---

## üîπ –®–ê–ì 6: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã Deploy

### 6.1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ —Ä–µ–∂–∏–º–µ dry-run

```bash
php8.2 artisan deploy --dry-run
```

–ö–æ–º–∞–Ω–¥–∞ –¥–æ–ª–∂–Ω–∞:
- ‚úÖ –ù–∞–π—Ç–∏ npm –∏ composer
- ‚úÖ –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ —à–∞–≥–∏ –¥–µ–ø–ª–æ—è
- ‚úÖ –ù–µ –≤—ã–ø–æ–ª–Ω—è—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è

### 6.2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–±–æ—Ä–∫–∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞

```bash
cd frontend
npm run build
cd ..
```

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–æ—è–≤–∏–ª–∞—Å—å –ø–∞–ø–∫–∞ `frontend/dist` —Å —Å–æ–±—Ä–∞–Ω–Ω—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏.

---

## üîπ –®–ê–ì 7: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ endpoint –¥–ª—è –¥–µ–ø–ª–æ—è (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

–ï—Å–ª–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å endpoint `/api/deploy` –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:

1. –°–æ–∑–¥–∞–π—Ç–µ —Ä–æ—É—Ç –≤ `routes/api.php`:
   ```php
   Route::post('/deploy', [DeployController::class, 'handle']);
   ```

2. –°–æ–∑–¥–∞–π—Ç–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–µ–ø–ª–æ—è

3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Ç–æ–∫–µ–Ω –≤ `.env` (`DEPLOY_TOKEN`)

---

## ‚úÖ –ò—Ç–æ–≥–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

–í—ã–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏:

```bash
# 1. Composer
composer -V

# 2. Node.js
node -v

# 3. npm
npm -v

# 4. –ü—É—Ç–∏
which composer
which node
which npm

# 5. Deploy (dry-run)
php8.2 artisan deploy --dry-run
```
```

–í—Å–µ –∫–æ–º–∞–Ω–¥—ã –¥–æ–ª–∂–Ω—ã —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ –æ—à–∏–±–æ–∫.

---

## üîß –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞)

–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫—É, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∫—Ä–∏–ø—Ç:

```bash
cd ~
# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ scripts/setup-server.sh –Ω–∞ —Å–µ—Ä–≤–µ—Ä
chmod +x setup-server.sh
./setup-server.sh
```

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–∫—Ä–∏–ø—Ç–∞ **–ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –ø–æ SSH** –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π PATH.

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –ø–æ SSH** - —ç—Ç–æ –ø—Ä–∏–º–µ–Ω–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è PATH –∏–∑ `.bashrc`

2. **–î–ª—è cron-–∑–∞–¥–∞—á** –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ–ª–Ω—ã–µ –ø—É—Ç–∏ –∏–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ PATH –≤ cron:
   ```bash
   # –í crontab –¥–æ–±–∞–≤—å—Ç–µ –≤ –Ω–∞—á–∞–ª–æ:
   PATH=/home/login/bin:/home/login/.nvm/versions/node/v20.10.0/bin:/usr/bin:/bin
   ```

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞**:
   ```bash
   chmod +x ~/bin/composer
   ls -la ~/bin/composer
   ```

4. **–ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ Node.js** —á–µ—Ä–µ–∑ nvm –æ–±–Ω–æ–≤–∏—Ç–µ –ø—É—Ç—å –≤ `.env` –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ `NPM_PATH`

---

## üÜò –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### Composer –Ω–µ –Ω–∞–π–¥–µ–Ω

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ
ls -la ~/bin/composer

# –î–æ–±–∞–≤—å—Ç–µ –≤ PATH –≤—Ä—É—á–Ω—É—é
export PATH="$HOME/bin:$PATH"
composer -V
```

### npm –Ω–µ –Ω–∞–π–¥–µ–Ω

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ nvm
source ~/.nvm/nvm.sh
nvm use --lts
npm -v

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—É—Ç—å
which npm
```

### –û—à–∏–±–∫–∏ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞
chmod +x ~/bin/composer
chown -R $USER:$USER ~/bin ~/.nvm
```

---

## üìù –ö—Ä–∞—Ç–∫–∞—è —à–ø–∞—Ä–≥–∞–ª–∫–∞ –∫–æ–º–∞–Ω–¥

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Composer
cd ~ && php8.2 -r "copy('https://getcomposer.org/installer', 'composer-setup.php');" && php8.2 composer-setup.php && rm composer-setup.php
mkdir -p ~/bin && mv composer.phar ~/bin/composer && chmod +x ~/bin/composer
echo 'export PATH="$HOME/bin:$PATH"' >> ~/.bashrc && source ~/.bashrc

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ nvm –∏ Node.js
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.7/install.sh | bash
source ~/.bashrc
nvm install --lts && nvm use --lts && nvm alias default node

# –ü—Ä–æ–≤–µ—Ä–∫–∞
composer -V && node -v && npm -v
```

---

**–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö —à–∞–≥–æ–≤ –∫–æ–º–∞–Ω–¥–∞ `php8.2 artisan deploy` –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ!** üöÄ

